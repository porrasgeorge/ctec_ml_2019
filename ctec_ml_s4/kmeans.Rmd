---
title: "K-Means"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Tarea 4.
# Metodos no supervisados

# Ejercicios 

Librerias
```{r}
#library('ggplot2')
library(tidyverse)
library(GGally)
library(reshape2)   # for melt function
```

1. Desarolle el Análisis del Problema
```{r}
# Construya el análisis del problema
```
Fuente del dataset:
https://archive.ics.uci.edu/ml/datasets/Wholesale+customers


2. Cargue el archivo Wholesale customers data.csv en una variable

```{r}

Wholesale <- data.frame(read.csv("Wholesale.csv"))
```

Se pasan las variables nominales a factor con sus respectivas etiquetas segun la documentacion de la pagina web.

```{r}
Wholesale$Channel <- factor(Wholesale$Channel, 
                          levels = c(1, 2), 
                          labels = c("HoReCa", "Retail")) 
Wholesale$Region <- factor(Wholesale$Region, 
                          levels = c(1, 2, 3), 
                          labels = c("Lisbon", "Oporto", "Other")) 


```

Observamdo la variable Fresh, tenemos algunos valores muy elevados que probablemente no representan a la mayoria de las compras, por lo cual se decide remover los valores mayores a 60000

```{r}
boxplot(Wholesale$Fresh)
```


de igual manera con la variable Milk, se liminan los valores mayores a 50000

```{r}
boxplot(Wholesale$Milk)
```

de Grecery los mayores a 50000

```{r}
boxplot(Wholesale$Grocery)
```

De Frozen los mayores a 30000

```{r}
boxplot(Wholesale$Frozen)
```

De detergents los mayores a 30000

```{r}
boxplot(Wholesale$Detergents_Paper)
```

de delicatessen los mayores a 10000

```{r}
boxplot(Wholesale$Delicassen)
```

```{r}
elements_before <- length(Wholesale$Channel)

Wholesale <- Wholesale %>% 
  filter (Fresh < 60000, 
          Milk < 50000,
          Grocery < 50000,
          Frozen < 30000,
          Detergents_Paper < 30000,
          Delicassen < 10000) 

elements_after <- length(Wholesale$Channel)
elements_deleted <- elements_before - elements_after
percent_deleted = 100 * elements_deleted / elements_before
```

Se puede observar que se eliminaron 14 filas
```{r}
elements_deleted
```
Que representan el 3.18% de los datos originales 

```{r}
percent_deleted
```


3. Desarolle el Entendimiento de los Datos

Se tienen 426 observaciones de 8 variables (2 factor y 6 numericas)

```{r}
glimpse(Wholesale)
```

Revisando los NAs (en la pagina decia que no habian), se corrobora la no existencia de NA.

```{r}
sum(is.na.data.frame(Wholesale))

```


Informacion acerca de la distribucion de los datos en la tabla

```{r}
summary(Wholesale)
```




4. Utilizando barplot cree un gráfico de los atributos del dataset, observe las correlaciones entre atributos

```{r}
hist(Wholesale$Fresh)
boxplot(Wholesale$Fresh)
```

```{r}
hist(Wholesale$Milk)
boxplot(Wholesale$Milk)
```

```{r}
hist(Wholesale$Grocery)
boxplot(Wholesale$Grocery)
```

```{r}
hist(Wholesale$Frozen)
boxplot(Wholesale$Frozen)
```

```{r}
hist(Wholesale$Detergents_Paper)
boxplot(Wholesale$Detergents_Paper)
```

```{r}
hist(Wholesale$Delicassen)
boxplot(Wholesale$Delicassen)
```


Del siguiente plot podemos observar que las corelaciones mas altas las tenemos entre:
  Groceries - Milk
  Groceries - Detergent_Paper
  Milk - Detergent_Paper

```{r}
ggpairs(Wholesale[-c(1, 2)], progress = F)
```

```{r}
ggpairs(Wholesale[c(1, 2)], progress = F)
```

5. Explique el siguiente gráfico

La funcion melt() deja las variables tipo factor y de las demas crea una sola columna "variable" tipo factor con el nombre y una columna "value" con el valor
```{r}
melted_data <- melt(Wholesale)
glimpse(melted_data)
```

El siguiente grafico muestra las ventas de los productos para cada canal, son los boxplot que muestran las distribucion de ventas de cada producto para los Caneles HoReCa y Retail.

```{r}
#Grafico
bxplt <- ggplot(data = melted_data, aes(x= variable, y = value))
bxplt <- bxplt + geom_boxplot()
bxplt <- bxplt + facet_wrap(~Channel)
bxplt <- bxplt + coord_flip()
bxplt <- bxplt + labs(x = 'Producto', y  = 'Ventas')
bxplt <- bxplt + ggtitle('Ventas por Producto y Canal')
bxplt

```

De manera semejante, el siguiente grafico muestra la distribucion de ventas de productos para cada Region (Lisbon, Oporto y Otras)

```{r}
#Grafico
bxplt2 <- ggplot(data = melted_data, aes(x= variable, y = value))
bxplt2 <- bxplt2 + geom_boxplot()
bxplt2 <- bxplt2 + facet_wrap(~Region)
bxplt2 <- bxplt2 + coord_flip()
bxplt2 <- bxplt2 + labs(x = 'producto', y  = 'ventas')
bxplt2 <- bxplt2 + ggtitle('Ventas por Producto y Region')
bxplt2

```


6. Cree un modelo de agrupación K- Means
Para agrupar a los clientes con base al consumo, vamos a utilizar solo las variables Fresh, Milk, Grocery, Frozen, Detergents_Paper y Delicassen. En este caso, vamos a intentar agrupar los clientes en 5 grupos diferentes.


```{r}
#5 Centroides utilizando k-means
set.seed(0)
modelo.agrupacion <- kmeans(Wholesale[,c(3:8)], centers = 5)

#predecir utilizando el modelo para agregar una variable nueva llamada 'cluster' al conjunto de datos
Wholesale$cluster <- modelo.agrupacion$cluster

#convertir la variable nueva a un factor
Wholesale$cluster <- factor(Wholesale$cluster)

Wholesale_resumed <- Wholesale %>% 
  mutate (sales = Delicassen + Detergents_Paper + Frozen + Fresh + Grocery + Milk, 
          cluster = cluster) %>% 
  select(cluster, sales)  

plot(Wholesale_resumed)

```

6. Realice al menos 3 modelos cambiando los centroides 
```{r}
# Escriba su código aqui
```

7. Evaluacioón del modelo
```{r}
# Escriba su código aqui
#Explicacion de los grupos generados
by(Wholesale, Wholesale$cluster, summary)
```


8. Desarolle al menos 5 conclusiones sobre los grupos realizados
  * Ejemplo:
    - Las principales características de cada grupo son:
      - #### Grupo #1: (2do grupo más pequeño)
      - Principalmente observaciones de la región 3 y el canal 1.
      - Muy alto consumo de productos frescos.
      - Bajo consumo de leche.
      - Bajo consumo de comestibles.
      - Alto consumo de alimentos congelados.
      - Bajo consumo de detergentes.
      - Bajo consumo de delicassen.


